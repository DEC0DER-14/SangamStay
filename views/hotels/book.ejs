<% layout('layouts/boilerplate') %>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">Book <%= hotel.name %></h2>
                    <form action="/hotels/<%= hotel._id %>/book" method="POST" class="validated-form" novalidate>
                        <div class="mb-3">
                            <label class="form-label" for="roomType">Select Room Type</label>
                            <select class="form-select" id="roomType" name="roomType" required>
                                <option value="">Choose a room type...</option>
                                <% hotel.rooms.forEach(room => { %>
                                    <option value="<%= room._id %>" 
                                            data-price="<%= room.pricePerNight %>"
                                            data-capacity="<%= room.capacity %>">
                                        <%= room.roomType %> - ₹<%= room.pricePerNight %>/night (Capacity: <%= room.capacity %> persons)
                                    </option>
                                <% }) %>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label" for="numberOfRooms">Number of Rooms</label>
                            <input type="number" class="form-control" id="numberOfRooms" name="numberOfRooms" 
                                   min="1" max="5" value="1" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label" for="numberOfGuests">Number of Guests</label>
                            <input type="number" class="form-control" id="numberOfGuests" name="numberOfGuests" 
                                   min="1" value="1" required>
                            <div class="form-text" id="guestCapacityMessage"></div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label" for="specialRequests">Special Requests (Optional)</label>
                            <textarea class="form-control" id="specialRequests" name="specialRequests" rows="3"></textarea>
                        </div>

                        <div class="card mb-3">
                            <div class="card-body">
                                <h5>Price Details</h5>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Room Rate:</span>
                                    <span id="roomRate">₹0</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Number of Rooms:</span>
                                    <span id="roomCount">1</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between fw-bold">
                                    <span>Total Amount:</span>
                                    <span id="totalAmount">₹0</span>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Confirm Booking</button>
                        <a href="/hotels/<%= hotel._id %>" class="btn btn-secondary">Cancel</a>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Booking Summary</h5>
                    <p class="card-text">
                        <strong>Hotel:</strong> <%= hotel.name %><br>
                        <strong>Location:</strong> <%= hotel.location %><br>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const roomTypeSelect = document.getElementById('roomType');
        const numberOfRoomsInput = document.getElementById('numberOfRooms');
        const numberOfGuestsInput = document.getElementById('numberOfGuests');
        const roomRateSpan = document.getElementById('roomRate');
        const roomCountSpan = document.getElementById('roomCount');
        const totalAmountSpan = document.getElementById('totalAmount');
        const guestCapacityMessage = document.getElementById('guestCapacityMessage');

        function updatePriceDetails() {
            const selectedOption = roomTypeSelect.options[roomTypeSelect.selectedIndex];
            const pricePerNight = selectedOption ? Number(selectedOption.dataset.price) : 0;
            const numberOfRooms = Number(numberOfRoomsInput.value);
            const capacity = selectedOption ? Number(selectedOption.dataset.capacity) : 0;

            roomRateSpan.textContent = `₹${pricePerNight}`;
            roomCountSpan.textContent = numberOfRooms;
            totalAmountSpan.textContent = `₹${pricePerNight * numberOfRooms}`;

            // Check guest capacity
            const maxGuests = capacity * numberOfRooms;
            const currentGuests = Number(numberOfGuestsInput.value);
            
            if (currentGuests > maxGuests) {
                guestCapacityMessage.textContent = `Maximum ${maxGuests} guests allowed for selected rooms`;
                guestCapacityMessage.className = 'text-danger';
            } else {
                guestCapacityMessage.textContent = `Maximum capacity: ${maxGuests} guests`;
                guestCapacityMessage.className = 'text-muted';
            }
        }

        roomTypeSelect.addEventListener('change', updatePriceDetails);
        numberOfRoomsInput.addEventListener('input', updatePriceDetails);
        numberOfGuestsInput.addEventListener('input', updatePriceDetails);

        // Initial calculation
        updatePriceDetails();
    });
</script> 